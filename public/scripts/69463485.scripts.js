(function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,relativeBars:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"StackedBar",defaults:d,initialize:function(a){var d=this.options;this.ScaleClass=b.Scale.extend({offsetGridLines:!0,calculateBarX:function(a){return this.calculateX(a)},calculateBarY:function(a,b,c,e){for(var f=0,g=0,h=0;h<a.length;h++)g+=a[h].bars[c].value;for(h=b;h<a.length;h++)f+=h===b&&e?e:a[h].bars[c].value;return d.relativeBars&&(f=f/g*100),this.calculateY(f)},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*d.barValueSpacing},calculateBaseHeight:function(){return this.calculateY(1)-this.calculateY(0)},calculateBarWidth:function(){return this.calculateBaseWidth()},calculateBarHeight:function(a,b,c,e){for(var f=0,g=0;g<a.length;g++)f+=a[g].bars[c].value;return e||(e=a[b].bars[c].value),d.relativeBars&&(e=e/f*100),this.calculateY(e)}}),this.datasets=[],this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getBarsAtEvent(a):[];this.eachBars(function(a){a.restore(["fillColor","strokeColor"])}),c.each(b,function(a){a.fillColor=a.highlightFill,a.strokeColor=a.highlightStroke}),this.showTooltip(b)}),this.BarClass=b.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),c.each(a.datasets,function(b){var d={label:b.label||null,fillColor:b.fillColor,strokeColor:b.strokeColor,bars:[]};this.datasets.push(d),c.each(b.data,function(e,f){c.isNumber(e)&&d.bars.push(new this.BarClass({value:e,label:a.labels[f],datasetLabel:b.label,strokeColor:b.strokeColor,fillColor:b.fillColor,highlightFill:b.highlightFill||b.fillColor,highlightStroke:b.highlightStroke||b.strokeColor}))},this)},this),this.buildScale(a.labels),this.eachBars(function(a,b){c.extend(a,{base:this.scale.endPoint,height:0,width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(b),y:this.scale.endPoint}),a.save()},this),this.render()},update:function(){this.scale.update(),c.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])}),this.eachBars(function(a){a.save()}),this.render()},eachBars:function(a){c.each(this.datasets,function(b,d){c.each(b.bars,a,this,d)},this)},getBarsAtEvent:function(a){for(var b,d=[],e=c.getRelativePosition(a),f=function(a){d.push(a.bars[b])},g=0;g<this.datasets.length;g++)for(b=0;b<this.datasets[g].bars.length;b++)if(this.datasets[g].bars[b].inRange(e.x,e.y))return c.each(this.datasets,f),d;return d},buildScale:function(a){var b=this,d=function(){var a=[];return c.each(b.datasets,function(d){c.each(d.bars,function(c,d){a[d]||(a[d]=0),b.options.relativeBars?a[d]=100:a[d]+=c.value})}),a},e={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:a.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){var b=c.calculateScaleRange(d(),a,this.fontSize,this.beginAtZero,this.integersOnly);c.extend(this,b)},xLabels:a,font:c.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&c.extend(e,{calculateYRange:c.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(e)},addData:function(a,b){c.each(a,function(a,d){c.isNumber(a)&&this.datasets[d].bars.push(new this.BarClass({value:a,label:b,x:this.scale.calculateBarX(this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[d].strokeColor,fillColor:this.datasets[d].fillColor}))},this),this.scale.addXLabel(b),this.update()},removeData:function(){this.scale.removeXLabel(),c.each(this.datasets,function(a){a.bars.shift()},this),this.update()},reflow:function(){c.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var a=c.extend({height:this.chart.height,width:this.chart.width});this.scale.update(a)},draw:function(a){var b=a||1;this.clear();this.chart.ctx;this.scale.draw(b),c.each(this.datasets,function(a,d){c.each(a.bars,function(a,c){var e=this.scale.calculateBarY(this.datasets,d,c,a.value),f=this.scale.calculateBarHeight(this.datasets,d,c,a.value);a.transition({base:this.scale.endPoint-(Math.abs(f)-Math.abs(e)),x:this.scale.calculateBarX(c),y:Math.abs(e),height:Math.abs(f),width:this.scale.calculateBarWidth(this.datasets.length)},b).draw()},this)},this)}})}).call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={tooltipTemplate:"<%if (label){%><%=label%>: <%}%>\n total invocation: <%= value %>\n with short-cut: <%= critical%>",dblclickAction:function(){},segmentShowStroke:!1,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:50,animationEasing:"easeOutQuart",animateRotate:!0,animateScale:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"StackedDoughnut",defaults:d,initialize:function(a){this.segments=[],this.outerRadius=(c.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,this.SegmentArc=b.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2}),this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getSegmentsAtEvent(a):[];c.each(this.segments,function(a){a.restore(["fillColor"])}),c.each(b,function(a){a.fillColor=a.highlightColor}),this.showTooltip(b)}),c.bindEvents(this,["dblclick"],function(a){var b=this.getSegmentsAtEvent(a);c.each(b,this.options.dblclickAction)}),this.calculateTotal(a),c.each(a,function(a,b){this.addData(a,b,!0)},this),this.render()},getSegmentsAtEvent:function(a){var b=[],d=c.getRelativePosition(a);return c.each(this.segments,function(a){a.inRange(d.x,d.y)&&b.push(a)},this),b},addData:function(a,b,c){var d=b||this.segments.length;this.segments.splice(d,0,new this.SegmentArc({value:a.value,critical:a.critical,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:a.color,highlightColor:a.highlight||a.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:1.5*Math.PI,circumference:this.options.animateRotate?0:this.calculateCircumference(a.value),label:a.label,id:a.id})),c||(this.reflow(),this.update())},calculateCircumference:function(a){return 2*Math.PI*(a/this.total)},calculateTotal:function(a){this.total=0,c.each(a,function(a){this.total+=a.value},this)},update:function(){this.calculateTotal(this.segments),c.each(this.activeElements,function(a){a.restore(["fillColor"])}),c.each(this.segments,function(a){a.save()}),this.render()},removeData:function(a){var b=c.isNumber(a)?a:this.segments.length-1;this.segments.splice(b,1),this.reflow(),this.update()},reflow:function(){c.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.outerRadius=(c.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,c.each(this.segments,function(a){a.update({outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(a){var b=a?a:1;this.clear(),c.each(this.segments,function(a,c){a.transition({circumference:this.calculateCircumference(a.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},b),a.endAngle=a.startAngle+a.circumference,a.draw(),this.getLossSegment(a).draw(),0===c&&(a.startAngle=1.5*Math.PI),c<this.segments.length-1&&(this.segments[c+1].startAngle=a.endAngle)},this)},getLossSegment:function(a){var b=function(){};b.prototype=a;var c=new b;return c.innerRadius=this.calcCriticalRadius(a),c.fillColor="rgba(0,0,0,0.5)",c},calcCriticalRadius:function(a){return a.innerRadius+(a.outerRadius-a.innerRadius)*a.critical/a.value}}),b.types.StackedDoughnut.extend({name:"StackedPie",defaults:c.merge(d,{percentageInnerCutout:0})})}.call(this);var angles=angular.module("angles",[]);angles.chart=function(a){return{restrict:"A",scope:{data:"=",options:"=",id:"@",width:"=",height:"=",resize:"=",chart:"@",segments:"@",responsive:"=",tooltip:"=",legend:"="},link:function(b,c){var d=c[0].getContext("2d"),e=!1;b.size=function(){b.width<=0?(c.width(c.parent().width()),d.canvas.width=c.width()):(d.canvas.width=b.width||d.canvas.width,e=!0),b.height<=0?(c.height(c.parent().height()),d.canvas.height=d.canvas.width/2):(d.canvas.height=b.height||d.canvas.height,e=!0)},b.$watch("data",function(h){f&&f.destroy(),h&&(b.chart&&(a=b.chart),e&&(b.size(),g=new Chart(d)),(b.responsive||b.resize)&&(b.options.responsive=!0),void 0!==b.responsive&&(b.options.responsive=b.responsive),f=g[a](b.data,b.options),f.update(),b.legend&&angular.element(c[0]).parent().after(f.generateLegend()))},!0),b.$watch("tooltip",function(a){if(f.draw(),void 0!==a&&f.segments&&!(!isFinite(a)||a>=f.segments.length||0>a)){var b=f.segments[a];b.save(),b.fillColor=b.highlightColor,f.showTooltip([b]),b.restore()}},!0),b.size();var f,g=new Chart(d)}}},angles.directive("chart",function(){return angles.chart()}),angles.directive("linechart",function(){return angles.chart("Line")}),angles.directive("barchart",function(){return angles.chart("Bar")}),angles.directive("radarchart",function(){return angles.chart("Radar")}),angles.directive("polarchart",function(){return angles.chart("PolarArea")}),angles.directive("piechart",function(){return angles.chart("Pie")}),angles.directive("doughnutchart",function(){return angles.chart("Doughnut")}),angles.directive("donutchart",function(){return angles.chart("Doughnut")}),angular.module("frontEndApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","angles"]).config(["$routeProvider",function(a){a.when("/command_detail/:userId",{templateUrl:"../views/command-detail.html",controller:"CommandDetailController"}).when("/reports/:userId",{templateUrl:"../views/report.html",controller:"ReportController"}).when("/recommendations/all/:userId",{templateUrl:"../views/all-recommendations.html",controller:"AllRecommendationsController"}).when("/:userId",{redirectTo:"/recommendations/current/:userId"}).when("/recommendations/:current/:userId",{templateUrl:"../views/current-recommendations.html",controller:"CurrentRecommendationsController"}).when("/",{templateUrl:"../views/invalid-route.html"}).otherwise({redirectTo:"/"})}]).filter("offset",function(){return function(a,b){return b=parseInt(b,10),a.slice(b)}}),angular.module("frontEndApp").controller("CurrentRecommendationsController",["$scope","$routeParams","RecommendationService","NavigationService",function(a,b,c,d){function e(a){if(0==a.length)return[];for(var b=[],c=0,d=0;d<a.length/2;d++)b[d]=a.slice(c,c+2),c+=2;return b}a.filterParams={},a.validUser={},a.initialized=!1,a.algorithmTypes={},a.chunkedRecommendations=[],a.viewingCurrent="current"==b.current,d.updateNavigation(b.userId,b.current),a.isValidUser=function(){c.isValidUser(b.userId).then(function(b){a.validUser=b})},a.isValidUser(),a.getAlgorithmTypes=function(){return c.getAlgorithmTypes(b.userId).then(function(b){a.algorithmTypes=b,a.currentAlgorithmType=b[0]})},a.getRecommendations=function(){c.getRecommendations(b.userId,b.current,a.currentAlgorithmType).then(function(b){a.chunkedRecommendations=e(b),a.initialized=!0})},a.getAlgorithmTypes().then(function(){a.getRecommendations()}),a.markAsUseful=function(a,b){c.markAsUseful(a,b).then()},a.saveRecommendation=function(b,d,e,f){c.saveRecommendation(b,d).then(function(c){b&&c&&a.chunkedRecommendations[e].splice(f,1)})},a.isUsefulSelected=function(a){return null==a?!1:a},a.isNotUsefulSelected=function(a){return null==a?!1:!a}}]),angular.module("frontEndApp").controller("NavigationController",["$scope","NavigationService",function(a,b){a.userId={},a.current={},a.$on("navigationUpdated",function(){a.current=b.current,a.userId=b.userId})}]),angular.module("frontEndApp").controller("CommandDetailController",["$scope","$http","$modal","$routeParams","CommandService","NavigationService",function(a,b,c,d,e,f){a.results=[],a.commandUnderEdit={},a.searched=!1,a.filter="no_details",a.currentPage=0,a.itemsPerPage=10,f.updateNavigation(d.userId,"command_detail");var g,h={templateUrl:"views/modals/edit-command.html",controller:"ModalCommandController"};a.search=function(){b.get("api/command_details/filter",{params:{filter_type:"command_id",filter_value:a.searchValue,filter:a.filter}}).success(function(b){a.results=b,a.currentPage=0,a.searched=!0}).error(function(){a.searched=!0})},a.showCommand=function(b,d){e.retrieveCommand(b).then(function(){g=c.open(h),g.result.then(function(b){a.results[d]=b})})}}]),angular.module("frontEndApp").service("RecommendationService",["$http",function(a){this.getRecommendations=function(b,c,d){var e=a.get("/api/get_recommendations/"+b+"/"+c,{params:{algorithm_type:d}}).then(function(a){return a.data});return e},this.markAsUseful=function(b,c){return a.get("/api/mark_recommendation/"+c.id,{params:{useful:b}}).then(function(){return c.useful=b,c})},this.saveRecommendation=function(b,c){return a.get("/api/save_recommendation/"+c.id,{params:{saved:b}}).then(function(){return c.saved=b,!0},function(){return!1})},this.isValidUser=function(b){return a.get("/api/users/is_valid/"+b).then(function(a){return a.data.valid},function(){return!1})},this.getAlgorithmTypes=function(b){return a.get("api/recommendations/"+b+"/algorithm_types").then(function(a){return a.data},function(){return[]})}}]),angular.module("frontEndApp").service("NavigationService",["$rootScope",function(a){this.userId={},this.current={},this.updateNavigation=function(b,c){this.userId=b,this.current=c,a.$broadcast("navigationUpdated")}}]),angular.module("frontEndApp").controller("AllRecommendationsController",["$scope","$routeParams","$modal","NavigationService","RecommendationService","CommandService",function(a,b,c,d,e,f){a.currentAlgorithmType="MOST_WIDELY_USED",a.validUser={},a.initialized=!1,a.algorithmTypes={},a.currentPage=0,a.itemsPerPage=10,a.recommendations=[];var g,h={templateUrl:"views/modals/edit-command.html",controller:"ModalCommandController"};d.updateNavigation(b.userId,"all"),a.isValidUser=function(){e.isValidUser(b.userId).then(function(b){a.validUser=b})},a.getAlgorithmTypes=function(){return e.getAlgorithmTypes(b.userId).then(function(b){a.algorithmTypes=b,a.currentAlgorithmType=b[0]})},a.getRecommendations=function(){e.getRecommendations(b.userId,"all",a.currentAlgorithmType).then(function(b){a.recommendations=b,a.initialized=!0})},a.isValidUser(),a.getAlgorithmTypes().then(function(){a.getRecommendations()}),a.showCommand=function(b,d){f.retrieveCommand(b).then(function(){g=c.open(h),g.result.then(function(b){a.recommendations[d].command_detail=b})})}}]),angular.module("frontEndApp").service("CommandService",["$http",function(a){this.currentCommand={};var b=this;this.retrieveCommand=function(c){return a.get("api/command_details/"+c+"/show").then(function(a){return b.currentCommand=a.data,a.data},function(){return null})},this.saveCommand=function(b){return a.post("api/command_details/"+b.id+"/update/",{command_name:b.command_name,description:b.description,shortcut:b.shortcut}).then(function(){return!0},function(){return!1})}}]),angular.module("frontEndApp").controller("ModalCommandController",["$scope","$modalInstance","CommandService",function(a,b,c){a.currentCommand=c.currentCommand,a.originalCommand=angular.copy(a.currentCommand),a.saved=!1,a.failedToSave=!1,a.saveCommand=function(){c.saveCommand(a.currentCommand).then(function(b){b?(a.saved=!0,a.failedToSave=!1):(a.saved=!1,a.failedToSave=!0)})},a.cancel=function(){c.command={},b.close(a.saved?a.currentCommand:a.originalCommand)}}]),angular.module("frontEndApp").service("ReportService",["$http",function(a){this.getReports=function(b){return a.get("/api/reports/"+b).then(function(a){return a.data},function(){return[]})},this.getReport=function(b,c){return a.get("/api/report/"+b,{params:{num_days:c}}).then(function(a){return a.data},function(){return[]})}}]),angular.module("frontEndApp").controller("ReportController",["$scope","$routeParams","$modal","CommandService","NavigationService","ReportService","RecommendationService",function(a,b,c,d,e,f,g){var h,i={templateUrl:"views/modals/edit-command.html",controller:"ModalCommandController"};e.updateNavigation(b.userId,"report"),a.validUser={},a.period=7,a.options={responsive:!0,dblclickAction:function(a){d.retrieveCommand(a.id).then(function(){h=c.open(i),h.result.then(function(){})})}},a.barchartData={labels:[],datasets:[{label:"Command invocation not using shortcuts",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[]},{label:"Command invocations using shortcuts",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[]}]};var j=function(){a.initialized=!1,a.reports=[],a.newlyLearnedCommands=[],a.commandStatChartData=[],a.colors=[],a.report=[],a.barchartData.labels=[],a.barchartData.datasets[0].data=[],a.barchartData.datasets[1].data=[]};a.isValidUser=function(){g.isValidUser(b.userId).then(function(b){a.validUser=b})},a.isValidUser(),a.getReport=function(){j(),f.getReport(b.userId,a.period).then(function(b){var c=b.stats;a.isStatsAvailable=c.length>0?!0:!1;for(var d=b.total_invocation,e=0,f=0;f<c.length;f+=1){var g=c[f],h=g.name||"Missing",i=g.shortcut,j=g.use_count,k=g.hotkey_count;g.new&&a.newlyLearnedCommands.push({name:h,shortcut:i}),a.commandStatChartData.push({value:j,critical:k,color:a.getHslColor(e,90,57),highlight:a.getHslColor(e,100,50),label:h,id:g._id}),e+=360/d*j,a.barchartData.labels.push(h+(i?" ("+i+")":"")),a.barchartData.datasets[0].data.push(j-k),a.barchartData.datasets[1].data.push(k)}a.initialized=!0})},a.getReport(),a.getHslColor=function(a,b,c){return"hsl("+a+","+b+"%,"+c+"%)"},a.getRecommendations=function(){g.getRecommendations(b.userId,"current","MOST_WIDELY_USED").then(function(b){null!=b&&(a.recommendations=b)})},a.getRecommendations()}]);