var angles=angular.module("angles",[]);angles.chart=function(a){return{restrict:"A",scope:{data:"=",options:"=",id:"@",width:"=",height:"=",resize:"=",chart:"@"},link:function(b,c){var d=c[0].getContext("2d"),e=!1;b.size=function(){b.width<=0?(c.width(c.parent().width()),d.canvas.width=c.width()):(d.canvas.width=b.width||d.canvas.width,e=!0),b.height<=0?(c.height(c.parent().height()),d.canvas.height=d.canvas.width/2):(d.canvas.height=b.height||d.canvas.height,e=!0)},b.$watch("data",function(c){if(c){if(b.chart&&(a=b.chart),e)b.size(),f=new Chart(d);else if(!c)return;f[a](b.data,b.options)}},!0),b.resize&&(angular.element(window).bind("resize",function(){b.size(),f=new Chart(d),f[a](b.data,b.options)}),b.$on("$destroy",function(){angular.element(window).off()})),b.size();var f=new Chart(d)}}},angles.directive("chart",function(){return angles.chart()}),angles.directive("linechart",function(){return angles.chart("Line")}),angles.directive("barchart",function(){return angles.chart("Bar")}),angles.directive("radarchart",function(){return angles.chart("Radar")}),angles.directive("polarchart",function(){return angles.chart("PolarArea")}),angles.directive("piechart",function(){return angles.chart("Pie")}),angles.directive("doughnutchart",function(){return angles.chart("Doughnut")}),angles.directive("donutchart",function(){return angles.chart("Doughnut")}),angular.module("frontEndApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","angles"]).config(["$routeProvider",function(a){a.when("/command_detail/:userId",{templateUrl:"../views/command-detail.html",controller:"CommandDetailController"}).when("/reports/:userId",{templateUrl:"../views/report.html",controller:"ReportController"}).when("/recommendations/all/:userId",{templateUrl:"../views/all-recommendations.html",controller:"AllRecommendationsController"}).when("/:userId",{redirectTo:"/recommendations/current/:userId"}).when("/recommendations/:current/:userId",{templateUrl:"../views/current-recommendations.html",controller:"CurrentRecommendationsController"}).when("/",{templateUrl:"../views/invalid-route.html"}).otherwise({redirectTo:"/"})}]).filter("offset",function(){return function(a,b){return b=parseInt(b,10),a.slice(b)}}),angular.module("frontEndApp").controller("CurrentRecommendationsController",["$scope","$routeParams","RecommendationService","NavigationService",function(a,b,c,d){function e(a){if(0==a.length)return[];for(var b=[],c=0,d=0;d<a.length/2;d++)b[d]=a.slice(c,c+2),c+=2;return b}a.filterParams={},a.validUser={},a.initialized=!1,a.algorithmTypes={},a.chunkedRecommendations=[],a.viewingCurrent="current"==b.current,d.updateNavigation(b.userId,b.current),a.isValidUser=function(){c.isValidUser(b.userId).then(function(b){a.validUser=b})},a.isValidUser(),a.getAlgorithmTypes=function(){return c.getAlgorithmTypes(b.userId).then(function(b){a.algorithmTypes=b,a.currentAlgorithmType=b[0]})},a.getRecommendations=function(){c.getRecommendations(b.userId,b.current,a.currentAlgorithmType).then(function(b){a.chunkedRecommendations=e(b),a.initialized=!0})},a.getAlgorithmTypes().then(function(){a.getRecommendations()}),a.markAsUseful=function(a,b){c.markAsUseful(a,b).then()},a.saveRecommendation=function(b,d,e,f){c.saveRecommendation(b,d).then(function(c){b&&c&&a.chunkedRecommendations[e].splice(f,1)})},a.isUsefulSelected=function(a){return null==a?!1:a},a.isNotUsefulSelected=function(a){return null==a?!1:!a}}]),angular.module("frontEndApp").controller("NavigationController",["$scope","NavigationService",function(a,b){a.userId={},a.current={},a.$on("navigationUpdated",function(){a.current=b.current,a.userId=b.userId})}]),angular.module("frontEndApp").controller("CommandDetailController",["$scope","$http","$modal","$routeParams","CommandService","NavigationService",function(a,b,c,d,e,f){a.results=[],a.commandUnderEdit={},a.searched=!1,a.filter="no_details",a.currentPage=0,a.itemsPerPage=10,f.updateNavigation(d.userId,"command_detail");var g,h={templateUrl:"views/modals/edit-command.html",controller:"ModalCommandController"};a.search=function(){b.get("api/command_details/filter",{params:{filter_type:"command_id",filter_value:a.searchValue,filter:a.filter}}).success(function(b){a.results=b,a.currentPage=0,a.searched=!0}).error(function(){a.searched=!0})},a.showCommand=function(b,d){e.retrieveCommand(b).then(function(){g=c.open(h),g.result.then(function(b){a.results[d]=b})})}}]),angular.module("frontEndApp").service("RecommendationService",["$http",function(a){this.getRecommendations=function(b,c,d){var e=a.get("/api/get_recommendations/"+b+"/"+c,{params:{algorithm_type:d}}).then(function(a){return a.data});return e},this.markAsUseful=function(b,c){return a.get("/api/mark_recommendation/"+c.id,{params:{useful:b}}).then(function(){return c.useful=b,c})},this.saveRecommendation=function(b,c){return a.get("/api/save_recommendation/"+c.id,{params:{saved:b}}).then(function(){return c.saved=b,!0},function(){return!1})},this.isValidUser=function(b){return a.get("/api/users/is_valid/"+b).then(function(a){return a.data.valid},function(){return!1})},this.getAlgorithmTypes=function(b){return a.get("api/recommendations/"+b+"/algorithm_types").then(function(a){return a.data},function(){return[]})}}]),angular.module("frontEndApp").service("NavigationService",["$rootScope",function(a){this.userId={},this.current={},this.updateNavigation=function(b,c){this.userId=b,this.current=c,a.$broadcast("navigationUpdated")}}]),angular.module("frontEndApp").controller("AllRecommendationsController",["$scope","$routeParams","$modal","NavigationService","RecommendationService","CommandService",function(a,b,c,d,e,f){a.currentAlgorithmType="MOST_WIDELY_USED",a.validUser={},a.initialized=!1,a.algorithmTypes={},a.currentPage=0,a.itemsPerPage=10,a.recommendations=[];var g,h={templateUrl:"views/modals/edit-command.html",controller:"ModalCommandController"};d.updateNavigation(b.userId,"all"),a.isValidUser=function(){e.isValidUser(b.userId).then(function(b){a.validUser=b})},a.getAlgorithmTypes=function(){return e.getAlgorithmTypes(b.userId).then(function(b){a.algorithmTypes=b,a.currentAlgorithmType=b[0]})},a.getRecommendations=function(){e.getRecommendations(b.userId,"all",a.currentAlgorithmType).then(function(b){a.recommendations=b,a.initialized=!0})},a.isValidUser(),a.getAlgorithmTypes().then(function(){a.getRecommendations()}),a.showCommand=function(b,d){f.retrieveCommand(b).then(function(){g=c.open(h),g.result.then(function(b){a.recommendations[d].command_detail=b})})}}]),angular.module("frontEndApp").service("CommandService",["$http",function(a){this.currentCommand={};var b=this;this.retrieveCommand=function(c){return a.get("api/command_details/"+c+"/show").then(function(a){return b.currentCommand=a.data,a.data},function(){return null})},this.saveCommand=function(b){return a.post("api/command_details/"+b.id+"/update/",{command_name:b.command_name,description:b.description,shortcut:b.shortcut}).then(function(){return!0},function(){return!1})}}]),angular.module("frontEndApp").controller("ModalCommandController",["$scope","$modalInstance","CommandService",function(a,b,c){a.currentCommand=c.currentCommand,a.originalCommand=angular.copy(a.currentCommand),a.saved=!1,a.failedToSave=!1,a.saveCommand=function(){c.saveCommand(a.currentCommand).then(function(b){b?(a.saved=!0,a.failedToSave=!1):(a.saved=!1,a.failedToSave=!0)})},a.cancel=function(){c.command={},b.close(a.saved?a.currentCommand:a.originalCommand)}}]),angular.module("frontEndApp").service("ReportService",["$http",function(a){this.getReports=function(b){return a.get("/api/reports/"+b).then(function(a){return a.data},function(){return[]})},this.getReport=function(b,c){return a.get("/api/report/"+b,{params:{num_days:c}}).then(function(a){return a.data},function(){return[]})}}]),angular.module("frontEndApp").controller("ReportController",["$scope","$routeParams","NavigationService","ReportService","RecommendationService",function(a,b,c,d,e){c.updateNavigation(b.userId,"report"),a.validUser={},a.period=7,a.options={responsive:!0},a.barchartData={labels:[],datasets:[{label:"Command invocation not using shortcuts",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[]},{label:"Command invocations using shortcuts",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[]}]};var f=function(){a.initialized=!1,a.isStatsAvailable=!1,a.reports=[],a.newlyLearnedCommands=[],a.commandStatChartData=[],a.colors=[],a.report=[],a.barchartData.labels=[],a.barchartData.datasets[0].data=[],a.barchartData.datasets[1].data=[]};a.isValidUser=function(){e.isValidUser(b.userId).then(function(b){a.validUser=b})},a.isValidUser(),a.getReport=function(){f(),d.getReport(b.userId,a.period).then(function(b){var c=b.stats;c.length>0&&(a.isStatsAvailable=!0);for(var d=b.total_invocation,e=0,f=0;f<c.length;f+=1){var g=c[f],h=g.name||"Missing",i=g.shortcut,j=g.use_count,k=g.hotkey_count;g.new&&a.newlyLearnedCommands.push({name:h,shortcut:i}),a.commandStatChartData.push({value:j,color:a.getHslColor(e,90,57),highlight:a.getHslColor(e,100,50),label:h}),e+=360/d*j,a.barchartData.labels.push(h+(i?" ("+i+")":"")),a.barchartData.datasets[0].data.push(j-k),a.barchartData.datasets[1].data.push(k)}a.initialized=!0})},a.getReport(),a.getHslColor=function(a,b,c){return"hsl("+a+","+b+"%,"+c+"%)"},a.getRecommendations=function(){e.getRecommendations(b.userId,"current","MOST_WIDELY_USED").then(function(b){null!=b&&(a.recommendations=b)})},a.getRecommendations()}]);